![Zoly](http://lucida-brasil.github.io/public/Images/zoly-logo.png)

# Instalação do Google Tag Manager

Última atualização: 06/09/2017

## Objetivo

Esse documento descreve os detalhes de como instalar o Google Tag Manager em seu site.<br />
Link do projeto: www.perdigaokits.com.br

### **Descrição Geral**

O `snippet` do Google Tag Manager é um pequeno trecho de código javascript ou non-javascript, através do uso de um iframe quando o javascript não está disponível, que é inserido nas páginas do site, tornando possível que a configuração das tags sejam realizadas via interface.


### **Posicionamento do Código - Google Tag Manager**

#### 1. Copie o seguinte JavaScript e cole-o o mais próximo da tag `<head>` de abertura possível em todas as páginas do seu site.

```html

<html>
  <head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-54GXKWL');</script>
    <!-- End Google Tag Manager -->
    //...
  </head>
```


#### 2. Copie o seguinte trecho e cole-o imediatamente após a marcação `<body>` de abertura em cada página do seu site.

```html
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-54GXKWL" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  //...
  </body>
</html>
```

Link de referência: [Documentação Oficial Google Tag Manager](https://developers.google.com/tag-manager/quickstart)


## Camada de dados (DataLayer) <br /> 
É um array de objetos javascript utilizado pelo Google Tag Manager para receber em seus atributos dados importantes do site.
Para implementar o dataLayer no site, o desenvolvedor pode utilizar formas diferentes para preencher os dados. Essas formas são dependentes da ação estabelecida na documentação e também do nível da interação. 

- Instalação<br />
Inserir a camada de dados antes do snippet de instalação do Google Tag Manager. Exemplo:

```html
<script>
  window.dataLayer = window.dataLayer || [];
  window.dataLayer = [{
    'atributo1': 'valor1',
    'atributo2': 'valor2'
  }];
</script>
```

OU
			
```html
<script>
  window.dataLayer = window.dataLayer || [];
  window.dataLayer.push({
    'atributo1': 'valor1',
    'atributo2': 'valor2'
  });
</script>
```

## Atributos HTML (Data Attributes) <br />
São atributos customizados inseridos nos elementos HTML da página que permite a inclusão de dados adicionais.

1. Elementos de link: ```<a href="..." class="minha_classe">Link</a>``` <br />
Elementos do tipo link que foram mapeados, precisam receber a classe **gtm-link-event** e os data attributes em sua estrutura.

```html
<a href="http://www.meudominio.com.br/page2"
  class="minha_classe gtm-link-event"
  data-gtm-event-category="[[exemplo valor categoria]]"
  data-gtm-event-action="[[exemplo valor acao]]"
  data-gtm-event-label="[[exemplo valor rotulo]]">Texto do link</a>
```

2. Elementos comuns: ```<div class="minha_classe">Elemento</div>``` <br />
Todos os elementos comuns do html que não são links e que foram mapeados, precisam receber a classe **gtm-element-event** em sua estrutura.
		
```html
<div class="minha_classe gtm-element-event" 
  data-gtm-event-category="[[exemplo valor categoria]]"
  data-gtm-event-action="[[exemplo valor acao]]"
  data-gtm-event-label="[[exemplo valor rotulo]]">Texto do elemento</div>
```


## Observações
> Os valores especificados entre colchetes `[[ ]]` são variáveis dinâmicas e devem ser substituídas por seus respectivos valores.<br />
> Todos os valores enviados ao Google Analytics devem estar sanitizados, ou seja, sem espaços, acentuação ou caracteres especiais.
> Caso o site já possua o Google Analytics instalado, será necessário a remoção do código de **todas as páginas do site**:

```html

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-82275903-2', 'auto');
ga('send', 'pageview');
</script>

```

## Contato

Em caso de dúvidas, por favor entrar em contato pelo e-mail: [brf@zoly.com.br](mailto:brf@zoly.com.br)
<br /><br />
<br />

